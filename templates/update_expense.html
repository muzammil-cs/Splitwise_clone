   {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <div style="position: fixed; top: 20px; right: 20px; z-index: 9999;">
        {% for category, message in messages %}
            {% set bg_color = '' %}
            {% if category == 'success' %}
            {% set bg_color = 'linear-gradient(135deg, #34d399, #06b6d4)' %}
            {% elif category == 'danger' %}
            {% set bg_color = 'linear-gradient(135deg, #ff5f6d, #ffc371)' %}
            {% endif %}
            <div class="flash-message" style="background: '{{ bg_color }}';">
                {{ message }}
            </div>

        {% endfor %}
        </div>
    {% endif %}
    {% endwith %}

<div style="display:flex; justify-content:center; align-items:center; min-height:70vh; background: linear-gradient(180deg, #0f172a 0%, #071033 100%); padding:20px;">
  <div style="background: linear-gradient(135deg, rgba(255,255,255,0.03), rgba(0,0,0,0.05)); border-radius:16px; padding:30px; width:100%; max-width:600px; box-shadow:0 10px 25px rgba(0,0,0,0.5);">
    
    <h3 style="color:#fff; text-align:center; margin-bottom:25px;">Update Expense</h3>

    <form method="POST">
      <!-- Title -->
      <div style="margin-bottom:15px;">
        <label style="color:#fff; font-weight:600;">Title</label>
        <input type="text" name="title" value="{{ expense.title }}" required
          style="width:100%; padding:10px; border-radius:10px; border:1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color:#fff;">
      </div>

      <!-- Total Amount -->
      <div style="margin-bottom:15px;">
        <label style="color:#fff; font-weight:600;">Total Amount</label>
        <input type="number" step="0.01" name="total_amount" value="{{ expense.total_amount }}" required
          style="width:100%; padding:10px; border-radius:10px; border:1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color:#fff;">
      </div>

      <!-- Currency -->
      <div style="margin-bottom:15px;">
        <label style="color:#fff; font-weight:600;">Currency</label>
        <input type="text" name="currency" value="{{ expense.currency }}"
          style="width:100%; padding:10px; border-radius:10px; border:1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color:#fff;">
      </div>

      <!-- Note -->
      <div style="margin-bottom:15px;">
        <label style="color:#fff; font-weight:600;">Note</label>
        <textarea name="note" style="width:100%; padding:10px; border-radius:10px; border:1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color:#fff;">{{ expense.note }}</textarea>
      </div>

      <!-- Participants -->
      <div style="margin-bottom:20px;">
        <label style="color:#fff; font-weight:600;">Participants</label>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin-top:5px;">
          {% for user in users %}
            <label style="display:flex; align-items:center; gap:5px; color:#fff;">
              <input type="checkbox" name="participants" value="{{ user.id }}"
                {% for p in expense.participants %}
                  {% if p.user_id == user.id %} checked {% endif %}
                {% endfor %}
                style="width:18px; height:18px; accent-color:#06b6d4;"
              >
              {{ user.username }}
            </label>
          {% endfor %}
        </div>
      </div>

      <!-- Submit -->
      <button type="submit" style="width:100%; padding:12px; border-radius:999px; font-weight:bold; border:none; background: linear-gradient(135deg, #34d399 0%, #06b6d4 100%); color:#021026; cursor:pointer;">Update Expense</button>
    </form>
  </div>
</div>
